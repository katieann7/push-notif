name: Pull Request Notifications

on:
  pull_request:
    types: [opened, reopened, synchronize, ready_for_review, closed]

permissions:
  issues: write

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      # -------------------------------
      # 1️⃣ PR Trigger Notification
      # -------------------------------
      - name: Notify PR Trigger
        if: github.event.action != 'closed' || (github.event.action == 'closed' && github.event.pull_request.merged == false)
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}   # e.g., smtp.gmail.com
          server_port: ${{ secrets.SMTP_PORT }}       # e.g., 587
          username: ${{ secrets.SMTP_USERNAME }}      # your email
          password: ${{ secrets.SMTP_PASSWORD }}      # app password
          from: "Team Notifications <${{ secrets.SMTP_USERNAME }}>"  # sender name + email
          to: ${{ secrets.EMAIL_TO }}                 # recipient(s)
          subject: "[PR Triggered] ${{ github.event.pull_request.title }}"
          body: |
            A pull request has been triggered for the branch: ${{ github.event.pull_request.base.ref }}.

            PR Title: ${{ github.event.pull_request.title }}
            Author: ${{ github.event.pull_request.user.login }}
            URL: ${{ github.event.pull_request.html_url }}

      # -------------------------------
      # 2️⃣ PR Merged Notification
      # -------------------------------
      - name: Notify PR Merged
        if: github.event.pull_request.merged == true
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          from: "Team Notifications <${{ secrets.SMTP_USERNAME }}>"  # sender name + email
          to: ${{ secrets.EMAIL_TO }}
          subject: "[PR Merged] ${{ github.event.pull_request.title }}"
          body: |
            A pull request has been merged into the branch: ${{ github.event.pull_request.base.ref }}.

            PR Title: ${{ github.event.pull_request.title }}
            Author: ${{ github.event.pull_request.user.login }}
            Merged By: ${{ github.event.pull_request.merged_by.login }}
            URL: ${{ github.event.pull_request.html_url }}
