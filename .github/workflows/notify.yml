name: Notify on Main Branch Push

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ GitHub Notification (via Issue)
      - name: Create GitHub Issue Notification
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "Push to main branch",
              body: `
              A push was made to the **main** branch.

              **Author:** ${context.payload.head_commit.author.name}
              **Message:** ${context.payload.head_commit.message}

              **Compare:** ${context.payload.compare}
              `
            })

      # 2️⃣ Slack Notification
      - name: Send Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_TITLE: Push Notification
          SLACK_COLOR: good
          SLACK_MESSAGE: >
            A push was made to the main branch by
            ${{ github.event.head_commit.author.name }}.
            Commit message: "${{ github.event.head_commit.message }}".
            See changes: ${{ github.event.compare }}
